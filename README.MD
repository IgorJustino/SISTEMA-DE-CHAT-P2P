# Sistema de Chat P2P em Rede Local

Este repositÃ³rio contÃ©m a implementaÃ§Ã£o completa de um **Sistema de Chat Peer-to-Peer (P2P)** para rede local com criptografia RSA. O sistema inclui um tracker central para autenticaÃ§Ã£o e descoberta de peers, alÃ©m de clientes que se comunicam diretamente entre si para troca de mensagens criptografadas e criaÃ§Ã£o de salas de chat.

## ğŸš€ Funcionalidades

### ğŸ” SeguranÃ§a
- **Criptografia RSA 2048 bits** para todas as comunicaÃ§Ãµes
- **AutenticaÃ§Ã£o segura** com senhas criptografadas
- **Chaves Ãºnicas** geradas para cada peer
- **ComunicaÃ§Ã£o P2P criptografada** entre clientes

### ğŸ’¬ Chat
- **Mensagens individuais** criptografadas entre peers
- **Salas de chat** com mÃºltiplos usuÃ¡rios
- **AdministraÃ§Ã£o de salas** (criar, entrar, expulsar membros)
- **HistÃ³rico de mensagens** por sala
- **Sistema de heartbeat** para detecÃ§Ã£o de peers inativos
- **Menu dinÃ¢mico** que se adapta ao status do usuÃ¡rio
- **DetecÃ§Ã£o automÃ¡tica** de expulsÃ£o de salas

### ğŸ“ Compartilhamento
- **Registro de arquivos** compartilhados por peer
- **Listagem de peers** e seus arquivos disponÃ­veis

---

## ğŸ“‹ PrÃ©-requisitos

- Python 3.8+ instalado
- Biblioteca `cryptography` para criptografia RSA

Instale as dependÃªncias com:

```bash
pip install cryptography
```

---

## ğŸš€ Como Executar

### 1. Iniciar o Tracker (Servidor Central)

No terminal, dentro da pasta `tracker/`, execute:

```bash
cd tracker
python3 tracker.py
```

O tracker ficarÃ¡ escutando em `0.0.0.0:8000` e serÃ¡ responsÃ¡vel por:
- AutenticaÃ§Ã£o de usuÃ¡rios
- Registro de peers conectados
- Gerenciamento de salas de chat
- Descoberta de peers para comunicaÃ§Ã£o P2P

### 2. Executar o Cliente Peer

Em outro terminal, ainda na pasta `tracker/`, execute:

```bash
python3 peer.py
```

O cliente solicitarÃ¡:
1. **Porta para escutar**: Digite uma porta (ex: 9001, 9002, etc.)
2. **Registro/Login**: Escolha se deseja registrar um novo usuÃ¡rio ou fazer login
3. **Credenciais**: Digite usuÃ¡rio e senha

### 3. Menu Principal

ApÃ³s o login, vocÃª terÃ¡ acesso Ã s seguintes opÃ§Ãµes:

1. **Listar peers** - Ver usuÃ¡rios conectados
2. **Enviar mensagem cifrada** - Chat individual P2P
3. **Criar sala** - Criar nova sala de chat
4. **Entrar em sala** - Juntar-se a uma sala existente
5. **Listar salas** - Ver salas disponÃ­veis
6. **Enviar mensagem em grupo** - Chat em sala especÃ­fica (sÃ³ aparece se estiver em alguma sala)
7. **Logout/Sair** - Desconectar do sistema

> **Nota**: O menu Ã© dinÃ¢mico - a opÃ§Ã£o "Enviar mensagem em grupo" sÃ³ aparece quando vocÃª estÃ¡ participando de alguma sala de chat.

---

## ğŸ”§ Comandos da API do Tracker

O tracker aceita comandos JSON via socket TCP na porta 8000. Formato geral:

```json
{ "cmd": "COMANDO", /* parÃ¢metros especÃ­ficos */ }
```

### Comandos DisponÃ­veis

| Comando | ParÃ¢metros | DescriÃ§Ã£o |
|---------|------------|-----------|
| `REGISTER` | `user`, `password` | Registra um novo usuÃ¡rio |
| `LOGIN` | `user`, `password`, `porta` | Autentica usuÃ¡rio e registra peer |
| `REGISTER_FILES` | `user`, `files` | Registra arquivos compartilhados |
| `LIST_PEERS` | *(nenhum)* | Lista peers conectados e arquivos |
| `CREATE_ROOM` | `room`, `user`, `senha` | Cria nova sala de chat |
| `JOIN_ROOM` | `room`, `user`, `senha` | Entra em sala existente |
| `LIST_ROOMS` | *(nenhum)* | Lista salas disponÃ­veis |
| `GET_ROOM_MEMBERS` | `room` | Lista membros de uma sala |
| `KICK_MEMBER` | `room`, `admin`, `member` | Expulsa membro (apenas admin) |
| `HEARTBEAT` | `user` | MantÃ©m conexÃ£o ativa |
| `LOGOUT` | `user` | Desconecta peer e limpa registros |

---

## ğŸ—ï¸ Arquitetura do Sistema

### Componentes Principais

1. **Tracker (`tracker.py`)**
   - Servidor central TCP na porta 8000
   - Gerencia autenticaÃ§Ã£o e registro de peers
   - MantÃ©m estado das salas de chat
   - Remove peers inativos automaticamente (timeout: 5 minutos)

2. **Cliente Peer (`peer.py`)**
   - Interface de usuÃ¡rio para chat
   - Conecta-se ao tracker para descoberta
   - ComunicaÃ§Ã£o P2P direta com outros peers
   - Criptografia/descriptografia de mensagens

### Fluxo de ComunicaÃ§Ã£o

1. **Descoberta**: Peer conecta ao tracker para autenticaÃ§Ã£o
2. **Registro**: Tracker registra IP/porta do peer
3. **Descoberta de Peers**: Cliente consulta tracker para encontrar outros usuÃ¡rios
4. **ComunicaÃ§Ã£o P2P**: Mensagens sÃ£o enviadas diretamente entre peers
5. **Criptografia**: Todas as mensagens sÃ£o criptografadas com RSA

---

## ğŸ“ PersistÃªncia de Dados

O sistema mantÃ©m os seguintes arquivos JSON na pasta `tracker/data/`:

- `users.json` - UsuÃ¡rios registrados e senhas criptografadas
- `peers.json` - Peers atualmente conectados (IP/porta/timestamp)
- `rooms.json` - Salas de chat, membros e administradores
- `files.json` - Arquivos compartilhados por peer

---

## ğŸ” SeguranÃ§a Implementada

- **Criptografia RSA**: Chaves de 2048 bits com padding OAEP
- **AutenticaÃ§Ã£o**: Senhas armazenadas criptografadas no tracker
- **ComunicaÃ§Ã£o P2P**: Mensagens criptografadas ponta-a-ponta
- **Timeout automÃ¡tico**: Peers inativos sÃ£o removidos apÃ³s 5 minutos
- **Chaves Ãºnicas**: Cada peer gera seu prÃ³prio par de chaves RSA

---

## ğŸ¯ CaracterÃ­sticas TÃ©cnicas

- **Linguagem**: Python 3.8+
- **DependÃªncias**: `cryptography`
- **Protocolo**: TCP/IP com sockets
- **Criptografia**: RSA-2048 com OAEP padding
- **Arquitetura**: Cliente-Servidor hÃ­brido (tracker) + P2P (peers)
- **Threading**: Suporte a mÃºltiplas conexÃµes simultÃ¢neas
- **Timeout**: 5 minutos para desconexÃ£o automÃ¡tica

---

## ğŸ’¡ Exemplo de Uso

### CenÃ¡rio: Dois usuÃ¡rios conversando

1. **UsuÃ¡rio A** (Porta 9001):
   ```bash
   python3 peer.py
   # Digite a porta: 9001
   # Escolha: 1 (Registrar)
   # UsuÃ¡rio: alice
   # Senha: minhasenha123
   ```

2. **UsuÃ¡rio B** (Porta 9002):
   ```bash
   python3 peer.py
   # Digite a porta: 9002
   # Escolha: 2 (Login)
   # UsuÃ¡rio: bob
   # Senha: senhabob456
   ```

3. **Alice** pode agora:
   - Listar peers para ver "bob" online
   - Enviar mensagem criptografada diretamente para bob
   - Criar uma sala de chat
   - Convidar bob para a sala

### Recursos de Salas de Chat

- **Administrador**: Quem cria a sala torna-se admin
- **Senha da sala**: NecessÃ¡ria para entrar
- **ExpulsÃ£o**: Apenas admin pode expulsar membros
- **HistÃ³rico**: Mensagens recebidas ficam armazenadas localmente
- **Menu adaptativo**: OpÃ§Ãµes mudam conforme status na sala
- **DetecÃ§Ã£o de expulsÃ£o**: Sistema detecta automaticamente se usuÃ¡rio foi expulso

---

## âš ï¸ Notas Importantes

- **Rede Local**: Sistema projetado para funcionar em LAN
- **Firewall**: Certifique-se de que as portas dos peers estÃ£o liberadas
- **Backup de Chaves**: As chaves RSA sÃ£o geradas automaticamente
- **PersistÃªncia**: Dados sÃ£o salvos em arquivos JSON
- **Timeout**: Peers inativos sÃ£o removidos automaticamente apÃ³s 5 minutos

---

### Estrutura do Projeto

```
â”œâ”€â”€ tracker/
â”‚   â”œâ”€â”€ tracker.py              # Servidor tracker principal
â”‚   â”œâ”€â”€ peer.py                 # Cliente peer (interface do usuÃ¡rio)
â”‚   â”œâ”€â”€ private_key.pem         # Chave privada do tracker (auto-gerada)
â”‚   â”œâ”€â”€ public_key.pem          # Chave pÃºblica do tracker (auto-gerada)
â”‚   â””â”€â”€ data/                   # Dados persistentes (criado automaticamente)
â”‚       â”œâ”€â”€ users.json          # UsuÃ¡rios registrados
â”‚       â”œâ”€â”€ peers.json          # Peers conectados
â”‚       â”œâ”€â”€ rooms.json          # Salas de chat
â”‚       â””â”€â”€ files.json          # Arquivos compartilhados
â”œâ”€â”€ peer_private_key.pem        # Chave privada dos peers (auto-gerada)
â”œâ”€â”€ peer_public_key.pem         # Chave pÃºblica dos peers (auto-gerada)
â””â”€â”€ README.MD                   # DocumentaÃ§Ã£o do projeto
```

### ğŸ“ Arquivos por Categoria

**CÃ³digo fonte principal:**
- `tracker/tracker.py` - Servidor central
- `tracker/peer.py` - Cliente peer

**Dados persistentes:**
- `tracker/data/*.json` - Criados automaticamente conforme uso

**Criptografia:**
- `tracker/*.pem` - Chaves do servidor tracker
- `peer_*.pem` - Chaves dos clientes peer

### ğŸ”§ Melhorias Implementadas

#### Interface Inteligente
- **Menu dinÃ¢mico**: OpÃ§Ãµes mudam conforme o status do usuÃ¡rio
- **DetecÃ§Ã£o automÃ¡tica**: Sistema identifica se usuÃ¡rio foi expulso de salas
- **Feedback visual**: Mensagens de debug e confirmaÃ§Ã£o

#### Chat em Grupo Otimizado  
- **Admin vÃª prÃ³prias mensagens**: CorreÃ§Ã£o do bug onde admin nÃ£o via suas mensagens
- **AtualizaÃ§Ã£o de peers**: Lista de usuÃ¡rios conectados Ã© atualizada a cada envio
- **HistÃ³rico local**: Todas as mensagens ficam salvas localmente

#### Estrutura Limpa
- **Arquivos duplicados removidos**: Projeto otimizado sem redundÃ¢ncias
- **OrganizaÃ§Ã£o clara**: SeparaÃ§Ã£o lÃ³gica entre chaves de tracker e peers
- **DocumentaÃ§Ã£o atualizada**: README reflete o estado real do projeto

---

### PrÃ³ximas Melhorias PossÃ­veis

- [ ] Interface grÃ¡fica (GUI)
- [ ] TransferÃªncia real de arquivos P2P
- [ ] NotificaÃ§Ãµes de mensagens
- [ ] HistÃ³rico persistente de mensagens
- [ ] Criptografia de arquivos compartilhados
- [ ] Suporte a emojis e formataÃ§Ã£o
- [ ] Chat de voz/vÃ­deo

---

*Desenvolvido como projeto educacional para demonstrar conceitos de redes P2P, criptografia RSA e programaÃ§Ã£o com sockets em Python.*

